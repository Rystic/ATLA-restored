decisions = {
#	play_avatar = {
#		is_high_prio = yes
#		only_playable = yes
#		ai = no
#
#		potential = {
#			is_avatar_trigger = no
#			event_target:global_avatar = {
#				is_avatar_trigger = yes
#				ai = yes
#			}
#			has_global_flag = playable_avatar
#		}
#		
#		allow = {
#			always = yes
#		}
#		
#		effect = {
#			find_avatar_effect = yes
#			set_player_character = event_target:global_avatar
#		}
#	}
	
	check_avatar_decision = {
		ai = no
		
		potential = {
			NOR = {
				trait = avatar
				trait = fullyrealisedavatar
				has_character_flag = avatar_revealed
			}
		}
		allow = {
			NOT = {
				has_character_flag = viewing_avatar_status
			}
		}
		effect = {
			set_character_flag = viewing_avatar_status
			character_event = {
				id = ATLAR.764
			}
		}
	}
	
	ruler_summons_avatar_revolt = {
		is_high_prio = yes
		only_rulers = yes
		
		potential = {
			is_title_active = d_avatar
			NOT = { has_landed_title = d_avatar }
			NOT = { has_global_flag = avatar_busy }
			NOT = {
				primary_title = {
					rebel = yes
				}
			}
			NOT = { has_any_opinion_modifier = avatar_refused_aid }
			any_war = { using_cb = peasant_revolt }
			NOT = { has_character_flag = avatar_aid }

			# avatar isn't busy with mastering elements
			d_avatar = {
				owner = {
					NOT = {
						has_character_flag = avatar_journey
					}
				}
			}
		}
		
		allow = {
			NOR = { 
				religion = way_of_chin
				religion = way_of_chin_reformed
				religion = fire_nation_imperialism
				religion = pirate_faith 
			}
		}
		
		effect = {
			log = "[Root.GetFullName] summoned the Avatar to help with a revolt."
			set_character_flag = avatar_aid
			d_avatar = {
				owner = {
					character_event = { id = avatar.179 }
				}
			}
		}
		
		ai_will_do = {
			factor = 0.5
		}
	
	}

}

targeted_decisions = {
	move_avatar = {
		is_high_prio = yes
		only_playable = yes
		filter = independent_rulers
		ai = no
		
		from_potential = {
			is_landed = no
			is_avatar_trigger = yes
		}
		
		potential = {
			is_within_diplo_range = FROM
			is_landed = yes
			# you're not already a tributary
			FROM = {
				NOR = {
					is_tributary = {
						type = unrevealed_avatar_tributary
						suzerain = PREV
					}
					is_tributary = {
						type = avatar_tributary
						suzerain = PREV
					}
				}
			}
		}
		
		allow = {
			FROM = {
				age >= 16
				NOT = {
					trait = on_journey
				}
				NOR = {
					is_rival = ROOT
					is_foe = ROOT
				}
			}
			opinion = {
				who = FROM
				value >= 0
			}
			OR = {
				custom_tooltip = {
					text = has_flying_pet_or_artifact_tt
					FROM = {
						has_flying_pet_or_artifact_trigger = yes
					}
				}
				custom_tooltip = {
					text = is_within_reach_tt
					ROOT = {
						capital_holding = {
							OR = {
								# avatar location is in 1000px range
								FROM = {
									location = {
										distance = {
											who = PREV
											value <= 1000
										}
									}
								}
								# location of avatar's suzerain is in 1000px range
								# FROM = {
								# 	suzerain = {
								# 		capital_holding = {
								# 			location = {
								# 				distance = {
								# 					who = PREVPREVPREVPREV
								# 					value <= 1000
								# 				}
								# 			}
								# 		}
								# 	}
								# }
							}
						}
					}
				}
			}
		}
		effect = {
			custom_tooltip = {
				text = move_avatar_tt
				FROM = {
					character_event = {
						id = new_avatar_journey.10
					}
				}
			}
		}
	}
}
