
namespace = ADUEL
namespace = agnikai

# agnikai.1 - notify target that they are challenged to agnikai
# agnikai.2 - notify that challenge to agnikai has accepted
# agnikai.3 - target refused to accept challenge
# agnikai.4 - begin a duel 

# Agni Kai - Challenged - Current Scope: Challenged
character_event = {
	id = agnikai.1
	desc = agnikai.1.desc
	picture = GFX_evt_agni_kai
	border = GFX_event_normal_frame_war
	is_triggered_only = yes
	
	immediate = { 
		FROMFROMFROM = {
			save_event_target_as = challenger
		}
	}
	
	option = { # Accept Challenge
		name = agnikai.1.opt.1
		event_target:challenger = {
			character_event = { id = agnikai.2 days = 3 } # Agni Kai - Accepted
		}
		# todo: add more ai chance modifiers
		# !ai
		ai_chance = {
			factor = 20
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 0.05
				trait = craven
			}
		}
	}
	option = { # Refuse Challenge - Great Dishonor
		name = agnikai.1.opt.2
		trigger = {
			is_great_fire_duelist_trigger = no
		}
		if = {
			limit = { 
				NOT = { trait = craven }
				NOT = { trait = brave }
			}
			random = {
				chance = 40
				add_trait = craven
			}
		}
		if = {
			limit = {
				trait = brave
			}
			remove_trait = brave
		}
		prestige = -100
		add_character_modifier = {
			modifier = agni_kai_refused_dishonor
			duration = 1095
		}
		event_target:challenger = {
			character_event = { id = agnikai.3 days = 3 } # Agni Kai - Fled
		}

		# todo: add more ai chance modifiers
		# !ai
		ai_chance = {
			factor = 1
		}
	}
	option = { # Refuse Challenge - No Dishonor
		name = agnikai.1.opt.3
		trigger = {
			is_great_fire_duelist_trigger = yes
			event_target:challenger = {
				is_great_fire_duelist_trigger = no
			}
		}
		add_character_modifier = {
			modifier = duel_refused_freely
			hidden = yes
			duration = 1095
		}
		event_target:challenger = {
			character_event = { id = ADUEL.9 days = 3 } # Agni Kai - Insulted
		}

		# todo: add more ai chance modifiers
		# !ai
		ai_chance = {
			factor = 30
			modifier = {
				factor = 2
				trait = fullyrealisedavatar
			}
			modifier = {
				factor = 2
				trait = firelord
			}
		}
	}
}

# Agni Kai - Challenge Accepted - Current Scope: Challenger
character_event = {
	id = agnikai.2
	desc = agnikai.2.desc
	picture = GFX_evt_agni_kai
	border = GFX_event_normal_frame_war
	is_triggered_only = yes
	
	option = { # Begin Duel
		name = agnikai.2.opt
		FROM = {
			character_event = { id = agnikai.4 } # Agni Kai - Begin Duel
		}
	}
}

# Agni Kai - Challenge Refused - Current Scope: Challenger
character_event = {
	id = agnikai.3
	desc = agnikai.3.desc
	picture = GFX_evt_agni_kai
	border = GFX_event_normal_frame_war
	is_triggered_only = yes
	
	option = { # END
		name = agnikai.3.opt
		prestige = 100
		opinion = {
			modifier = opinion_agni_kai_cowadice
			who = FROM
			years = 100
		}
	}
}

# Agni Kai - Duel Begin
character_event = {
	id = agnikai.4
	desc = { # Strong / Master
		trigger = {
			OR = {
				trait = master_bender
				trait = legendary_bender
			}
			OR = {
				trait = strong
				trait = robust
			}
		}
		text = agnikai.4.desc.1
	}
	desc = { # Average / Master
		trigger = {
			OR = {
				trait = master_bender
				trait = legendary_bender
			}
			NOR = {
				trait = strong
				trait = robust
				trait = feeble
				trait = weak
			}
		}
		text = agnikai.4.desc.2
	}
	desc = { # Weak / Master
		trigger = {
			OR = {
				trait = master_bender
				trait = legendary_bender
			}
			OR = {
				trait = feeble
				trait = weak
			}
		}
		text = agnikai.4.desc.3
	}
	desc = { # Strong / Adept
		trigger = {
			OR = {
				trait = powerful_bender
				trait = competent_bender
			}
			OR = {
				trait = strong
				trait = robust
			}
		}
		text = agnikai.4.desc.4
	}
	desc = { # Average / Adept
		trigger = {
			OR = {
				trait = powerful_bender
				trait = competent_bender
			}
			NOR = {
				trait = strong
				trait = robust
				trait = feeble
				trait = weak
			}
		}
		text = agnikai.4.desc.5
	}
	desc = { # Weak / Adept
		trigger = {
			OR = {
				trait = powerful_bender
				trait = competent_bender
			}
			OR = {
				trait = feeble
				trait = weak
			}
		}
		text = agnikai.4.desc.6
	}
	desc = { # Strong / Unskilled
		trigger = {
			trait = incompetent_bender
			OR = {
				trait = strong
				trait = robust
			}
		}
		text = agnikai.4.desc.7
	}
	desc = { # Average / Unskilled
		trigger = {
			trait = incompetent_bender
			NOR = {
				trait = strong
				trait = robust
				trait = feeble
				trait = weak
			}
		}
		text = agnikai.4.desc.8
	}
	desc = { # Weak / Unskilled
		trigger = {
			trait = incompetent_bender
			OR = {
				trait = feeble
				trait = weak
			}
		}
		text = agnikai.4.desc.9
	}
	picture = GFX_evt_agni_kai
	border = GFX_event_normal_frame_war
	is_triggered_only = yes
	
	immediate = { # Set up Character Stats
		set_character_flag = preparedForDuel
		clr_character_flag = used_earthquake
		clr_character_flag = has_used_fireball
		ROOT = {
			set_duel_variables_effect = yes
		}
	}
	
	option = { # Begin Duel
		name = agnikai.4.opt
		trigger = {
			FROM = { has_character_flag = preparedForDuel }
		}
		clr_character_flag = preparedForDuel
		FROM = {
			clr_character_flag = preparedForDuel
		}
		character_event = { id = ADUEL.14 } # Duel - First Action
	}
	
	option = { # Ping opponent
		name = agnikai.4.opt
		save_event_target_as = other_hostile
		trigger = {
			FROM = { NOT = { has_character_flag = preparedForDuel } }
		}
		FROM = {
			character_event = { id = agnikai.4 } # PING
		}
	}
}